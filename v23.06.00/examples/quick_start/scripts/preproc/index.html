

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Preprocessing script &#8212; NVIDIA Merlin</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/versions.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../../../../_static/js/rtd-version-switcher.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/quick_start/scripts/preproc/index';</script>
    <link rel="canonical" href="https://nvidia-merlin.github.io/Merlin/stable/examples/quick_start/scripts/preproc/index.html" />
    <link rel="shortcut icon" href="../../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-NVJ1Y1YJHK"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-NVJ1Y1YJHK', {
        'anonymize_ip': false,
    });
  </script>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,400;0,700;1,300&display=swap" rel="stylesheet">
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">NVIDIA Merlin</p>
  
</a></div>
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html">Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../guide/recommender_system_guide.html">Recommender System Guide</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../guide/recommender_models.html">Recommender Models</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../index.html">Example Notebooks</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../getting-started-movielens/index.html">Getting Started using the MovieLens Dataset</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-movielens/01-Download-Convert.html">MovieLens Download and Convert</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-movielens/02-ETL-with-NVTabular.html">Feature Engineering with NVTabular</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-movielens/03-Training-with-HugeCTR.html">Training with HugeCTR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-movielens/03-Training-with-TF.html">Getting Started MovieLens: Training with TensorFlow</a></li>


<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-movielens/03-Training-with-PyTorch.html">Training with PyTorch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-movielens/04-Triton-Inference-with-HugeCTR.html">Serving the HugeCTR Model with Triton</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-movielens/04-Triton-Inference-with-TF.html">Serve Recommendations from the TensorFlow Model</a></li>

</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../Building-and-deploying-multi-stage-RecSys/index.html">Deploying a Multi-Stage Recommender System</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../Building-and-deploying-multi-stage-RecSys/01-Building-Recommender-Systems-with-Merlin.html">Building the Recommender System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Building-and-deploying-multi-stage-RecSys/02-Deploying-multi-stage-RecSys-with-Merlin-Systems.html">Deploying the Recommender System with Triton</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sagemaker-tensorflow/index.html">Merlin and AWS SageMaker</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sagemaker-tensorflow/sagemaker-merlin-tensorflow.html">Training and Serving Merlin on AWS SageMaker</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../scaling-criteo/index.html">Scaling Large Datasets with Criteo</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../scaling-criteo/01-Download-Convert.html">Criteo Download and Convert</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../scaling-criteo/02-ETL-with-NVTabular.html">Feature Engineering with NVTabular</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../scaling-criteo/03-Training-with-HugeCTR.html">Training with HugeCTR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../scaling-criteo/03-Training-with-Merlin-Models-TensorFlow.html">Training with Merlin Models and TensorFlow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../scaling-criteo/04-Triton-Inference-with-HugeCTR.html">Deploy the HugeCTR Model with Triton</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../scaling-criteo/04-Triton-Inference-with-Merlin-Models-TensorFlow.html">Deploy the TensorFlow Model with Triton</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../containers.html">Merlin Containers</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../support_matrix/index.html">Merlin Support Matrix</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../support_matrix/support_matrix_merlin_hugectr.html">Merlin HugeCTR Support Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../support_matrix/support_matrix_merlin_tensorflow.html">Merlin TensorFlow Support Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../support_matrix/support_matrix_merlin_pytorch.html">Merlin PyTorch Support Matrix</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-merlin-ecosystem-nav" aria-label="Merlin Ecosystem Nav">
  <div class="bd-toc-item navbar-nav">
    <p aria-level="2" class="caption" role="heading"><span class="caption-text">Ecosystem</span></p>
    <ul class="nav bd-sidenav">
      <li class="toctree-l1"><a class="reference external" href="/core/v23.06.00">Core</a></li>
      <li class="toctree-l1"><a class="reference external" href="/models/v23.06.00">Models</a></li>
      <li class="toctree-l1"><a class="reference external" href="/systems/v23.06.00">Systems</a></li>
      <li class="toctree-l1"><a class="reference external" href="/NVTabular/v23.06.00">NVTabular</a></li>
      <li class="toctree-l1"><a class="reference external" href="/Transformers4Rec/v23.06.00">Transformers4Rec</a></li>
      <li class="toctree-l1"><a class="reference external" href="/dataloader/v23.06.00">Dataloader</a></li>
      <li class="toctree-l1"><a class="reference external" href="/HugetCTR/v23.06.00">HugeCTR</a></li>
    </ul>
  </div>
</nav></div>
        <div class="sidebar-primary-item">
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"></span>
    v: v23.06.00
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../../../v23.05.00/index.html">v23.05.00</a></dd>
      <dd><a href="index.html">v23.06.00</a></dd>
      <dd><a href="../../../../../v23.08.00/index.html">v23.08.00</a></dd>
      <dd><a href="../../../../../v23.09.00/index.html">v23.09.00</a></dd>
      <dd><a href="../../../../../v23.12.00/index.html">v23.12.00</a></dd>
      <dd><a href="../../../../../v24.06.00/index.html">v24.06.00</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../../../main/index.html">main</a></dd>
      <dd><a href="../../../../../stable/index.html">stable</a></dd>
    </dl>
  </div>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/NVIDIA-Merlin/Merlin" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../_sources/" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Preprocessing script</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Preprocessing script</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#best-practices">Best practices</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-task">Defining the task</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-features">Preprocessing features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-high-cardinality-data">Dealing with high-cardinality data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering">Feature Engineering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-set-splitting">Data set splitting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#command-line-arguments">Command line arguments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs">Inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs">Outputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#features-and-targets-definition">Features and targets definition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#target-encoding-features">Target encoding features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-casting-and-filtering">Data casting and filtering</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-and-frequency-capping">Filtering and frequency capping</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-splitting-train-and-eval-sets">Dataset splitting (train and eval sets)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cuda-cluster-options">CUDA cluster options</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="preprocessing-script">
<h1>Preprocessing script<a class="headerlink" href="#preprocessing-script" title="Permalink to this heading">#</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">preprocessing.py</span></code> is a template script that provides basic preprocessing and feature engineering operations for tabular data, so that they are better represented for neural models. It uses the <a class="reference external" href="https://github.com/NVIDIA-Merlin/NVTabular">NVTabular</a> and <a class="reference external" href="https://github.com/rapidsai/cudf/tree/main/python/dask_cudf">dask-cudf</a> libraries for GPU accelerated preprocessing.</p>
<p>In this document we describe the provided preprocessing and feature engineering options and the corresponding command line arguments.</p>
<section id="best-practices">
<h2>Best practices<a class="headerlink" href="#best-practices" title="Permalink to this heading">#</a></h2>
<p>In this section we list some best practices on preprocessing and feature engineering for preparing data for neural models.</p>
<section id="dataset">
<h3>Dataset<a class="headerlink" href="#dataset" title="Permalink to this heading">#</a></h3>
<p>The typical data to train recommender systems is the <strong>log of user interactions</strong> on items from a platform like e-commerce, news portal, social network, ad network, streaming media platform, among others.
In addition to users interactions.
The logged users interaction might contain explicit feedback from users, e.g. like, dislike, rating, or implicit feedback events, e.g. click, comment, add-to-cart, purchase, which might be positive or negative, e.g. items shown to the user and ignored.</p>
</section>
<section id="defining-the-task">
<h3>Defining the task<a class="headerlink" href="#defining-the-task" title="Permalink to this heading">#</a></h3>
<p>You need to prepare the dataset according to the desired task.</p>
<p><strong>Retrieval</strong> - The model objective is to return for a given user the top-k recommended items. In this case, the data can contain only positive interactions as retrieval models are typically trained using negative sampling from other users interactions, not requiring implicit negatives.</p>
<p><strong>Ranking</strong> - The model objective is to score the relevance of a target item for a given user. In this case, you have at least one target column that express implicit or explicit your feedback you want to predict. Typically each target will be used by either a binary classification (e.g. predicting binary events like click, <code class="docutils literal notranslate"><span class="pre">--binary_classif_targets</span></code>) or regression task (e.g. estimating rating, <code class="docutils literal notranslate"><span class="pre">--regression_targets</span></code>). You can see below an example of the TenRec dataset that is suitable for ranking.</p>
<p><img alt="TenRec dataset structure" src="../../../../_images/tenrec_dataset.png" /></p>
</section>
<section id="preprocessing-features">
<h3>Preprocessing features<a class="headerlink" href="#preprocessing-features" title="Permalink to this heading">#</a></h3>
<p>When preparing the data, you need to include features that are relevant for predicting a user interaction, which might include user features that are static (e.g. user id, age, gender), dynamic contextual features (e.g. location, device) and item features (e.g. item id, category, price).<br />
For neural networks there is an important distinction between categorical and continuous features.</p>
<p><strong>Continuous features</strong><br />
Continuous features (<code class="docutils literal notranslate"><span class="pre">--continuous_features</span></code>) are naturally fed into neural networks, they typically just need need to be normalized to avoid numerical scaling issues. Typical approaches for normalizing continuous features are <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.Normalize.html#nvtabular.ops.Normalize">standardization (Z-scaling)</a> and <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.NormalizeMinMax.html#nvtabular.ops.NormalizeMinMax">min-max scaling</a>.
It is important to have a strategy for imputation of missing values (e.g. with a constant <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.FillMissing.html#nvtabular.ops.FillMissing">float</a>, or some statistic like mean or <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.FillMedian.html#nvtabular.ops.FillMedian">median</a>), as null (NaN) values are not acceptable as input by neural networks.</p>
<p><strong>Categorical features</strong><br />
Categorical features (<code class="docutils literal notranslate"><span class="pre">--categorical_features</span></code>) are nominal data, which  typically strings or id numbers that don’t have any meaningful order or scaling properties. They are typically <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.Categorify.html#nvtabular.ops.Categorify">categorified</a> / represented as continuous ids, so that when fed to a model they can be represented either as one-hot representation for linear models or embedded for neural networks.</p>
</section>
<section id="dealing-with-high-cardinality-data">
<h3>Dealing with high-cardinality data<a class="headerlink" href="#dealing-with-high-cardinality-data" title="Permalink to this heading">#</a></h3>
<p>Large services might have categorical features with very high cardinality (e.g. order of hundreds of millions or higher), like user id or item id. They typically require a high memory to be stored (e.g. with embedding tables) or processed (e.g. with one-hot encoding). In addition, most of the categorical values are very infrequent, for which it is not possible to learn good embeddings. Thus, your make some modeling choices in order to preprocess those categorical features accordingly. Here are some options:</p>
<ul class="simple">
<li><p><strong>Keep the original high-cardinality</strong> - If you are going use a model with distributed embedding solution, that will support sharding the embedding table across multiple devices(typically GPUs) to avoid going out-of-memory, then you can categorify the features just as you do for low-cardinality ones.</p></li>
<li><p><strong>Frequency capping</strong> (<code class="docutils literal notranslate"><span class="pre">--categ_min_freq_capping</span></code>)- Infrequent values are mapped to 0, forming a cluster of infrequent / cold-start users/items that can be useful for training the model to deal with them.</p></li>
<li><p><strong>Filtering out infrequent values</strong> (<code class="docutils literal notranslate"><span class="pre">--min_user_freq</span></code>, <code class="docutils literal notranslate"><span class="pre">--min_item_freq</span></code>) - You might <em>filter out</em> interactions from infrequent or fresh users or items, which are typically the majority of systems interactions as they typically follow the long-tail distribution.</p></li>
<li><p><strong>Hashing</strong> - An additional option is to hash the categorical values into a number of buckets much lower than the feature cardinality. That way, you introduce collisions as a trade-off for lower final cardinality and memory requirements in the modeling side. This can be in the <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.HashBucket.html#nvtabular.ops.HashBucket">preprocessing</a> or in the modeling.</p></li>
</ul>
</section>
<section id="feature-engineering">
<h3>Feature Engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this heading">#</a></h3>
<p>Feature engineering allows designing new features from raw data that are can provide useful information to the model with respect to the prediction task.</p>
<p>In this section we list common feature engineering techniques. Most of them are implemented as <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/api.html#categorical-operators">ops</a> in <a class="reference external" href="https://github.com/NVIDIA-Merlin/NVTabular">NVTabular</a>. User defined functions (UDF) can be implemented with <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.LambdaOp.html#nvtabular.ops.LambdaOp">Lambda</a> op, which are very useful for example for dealing with temporal and geographic feature engineering.</p>
<p>TIP: This preprocessing script provides just basic feature engineering. For more using those more advanced techniques you can either copy <code class="docutils literal notranslate"><span class="pre">preprocessing.py</span></code> and change it, or you can create a class inheriting from the <code class="docutils literal notranslate"><span class="pre">PreprocessingRunner</span></code> class (in <code class="docutils literal notranslate"><span class="pre">preprocessing.py</span></code>) and override the <code class="docutils literal notranslate"><span class="pre">generate_nvt_features()</span></code> method to customize the preprocessing workflow with different NVTabular ops.</p>
<p><strong>Continuous features</strong></p>
<ul class="simple">
<li><p>Smoothing long-tailed distributions of continuous features with <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.LogOp.html#nvtabular.ops.LogOp">Log</a>, so that the range of large numbers is compressed and the range of small numbers is expanded.</p></li>
<li><p>Continuous features can be represented as categorical features by either binarization (converting to binary) or <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.Bucketize.html#nvtabular.ops.Bucketize">binning</a> (converting to multiple categorical or ordinal values). That might be useful to group together values that are similar, e.g., periods of the day, age ranges of users, etc.</p></li>
</ul>
<p><strong>Categorical features</strong></p>
<ul class="simple">
<li><p>Besides contiguous ids, categorical features can be also represented by global statistics of their values, or by statistics conditioned in other columns. Some popular techniques are:</p>
<ul>
<li><p><strong>Count encoding</strong> - represents the count of a given categorical value across the whole dataset (e.g. count of user past interactions)</p></li>
<li><p><strong>Target encoding</strong> - represents one statistic of a categorical column conditioned on a target column. One example would be computing the average of click binary target segmented by the item id categorical values, which represents its Click-Through Rate (CTR) or likelihood to be clicked by a random user. <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.TargetEncoding.html#nvtabular.ops.TargetEncoding"><em>Target encoding</em></a> is a very powerful feature engineering technique, and has been a key for many of our <a class="reference external" href="https://medium.com/rapids-ai/winning-solution-of-recsys2020-challenge-gpu-accelerated-feature-engineering-and-training-for-cd67c5a87b1f">winning solutions</a> for RecSys competitions. You can create target encoded features with this script, by setting the <code class="docutils literal notranslate"><span class="pre">--target_encoding_features</span></code> and <code class="docutils literal notranslate"><span class="pre">--target_encoding_targets</span></code> arguments to define which categorical columns and targets should be used for generating the target encoded features.</p></li>
</ul>
</li>
</ul>
<p><strong>Temporal features</strong></p>
<ul class="simple">
<li><p>Extracting temporal features from timestamps, like day of week, day, month, year, quarter, hour, period of the day, among others.</p></li>
<li><p>Compute the “age” of the item or how long the user is active in the system, e.g. by subtracting the interaction timestamp by the timestamp when the user/item were seen for the first time.</p></li>
<li><p>Trending features might also be useful: for example, including continuous features that accumulates the user engagement in a specific category of product the last month, quarter, semester.</p></li>
</ul>
<p><strong>Geographic features</strong></p>
<ul class="simple">
<li><p>You can treat Zip codes, cities, states, countries as categorical features</p></li>
<li><p>If latitude/longitude are available, you can also compute distances, e.g. the distance between a hotel (item) location and the user location / airport / touristic landmark.</p></li>
<li><p>You can also enrich adding features based on external geolocation data (e.g. from census or government).,</p></li>
</ul>
</section>
<section id="data-set-splitting">
<h3>Data set splitting<a class="headerlink" href="#data-set-splitting" title="Permalink to this heading">#</a></h3>
<p>There are many approaches for splitting (<code class="docutils literal notranslate"><span class="pre">--dataset_split_strategy</span></code>) train and evaluation data:</p>
<ul class="simple">
<li><p><strong>random</strong> - Examples are randomly assigned to train and eval sets (according to a percentage, <code class="docutils literal notranslate"><span class="pre">--random_split_eval_perc</span></code>).</p></li>
<li><p><strong>random by user</strong> - It is like random but stratified by user.Ensures that users have examples in both train and eval sets. This approach doesn’t provide cold-start users on eval set.</p></li>
<li><p><strong>temporal</strong> - Uses a reference timestamp (<code class="docutils literal notranslate"><span class="pre">--dataset_split_temporal_timestamp</span></code>) to split train and eval sets. Typically this is the most realistic approach, as when deployed models will not have access to future information when performing predictions.</p></li>
</ul>
</section>
</section>
<section id="command-line-arguments">
<h2>Command line arguments<a class="headerlink" href="#command-line-arguments" title="Permalink to this heading">#</a></h2>
<p>In this section we describe the command line arguments of the preprocessing script.</p>
<p>The input and format can be CSV, TSV or Parquet, but the latter is recommended for being a columnar format which is faster to preprocess. Output preprocessing format is parquet format.</p>
<blockquote>
<div><p>You can check how to <a class="reference internal" href="../../ranking.html"><span class="std std-doc">setup the Docker container</span></a> to run <code class="docutils literal notranslate"><span class="pre">preprocessing.py</span></code> script with Docker.</p>
</div></blockquote>
<p>Here is an example command line for running preprocessing for the TenRec dataset in our Docker image, which is explained <a class="reference internal" href="../../ranking.html"><span class="std std-doc">here</span></a>.
The parameters and their values can be separated by either space or by <code class="docutils literal notranslate"><span class="pre">=</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/Merlin/examples/
<span class="nv">OUT_DATASET_PATH</span><span class="o">=</span>/outputs/dataset
python<span class="w"> </span>-m<span class="w"> </span>quick_start.scripts.preproc.preprocessing<span class="w"> </span>--input_data_format<span class="o">=</span>csv<span class="w"> </span>--csv_na_values<span class="o">=</span><span class="se">\\</span>N<span class="w"> </span>--data_path<span class="w"> </span>/data/QK-video.csv<span class="w"> </span>--filter_query<span class="o">=</span><span class="s2">&quot;click==1 or (click==0 and follow==0 and like==0 and share==0)&quot;</span><span class="w"> </span>--min_item_freq<span class="o">=</span><span class="m">30</span><span class="w"> </span>--min_user_freq<span class="o">=</span><span class="m">30</span><span class="w"> </span>--max_user_freq<span class="o">=</span><span class="m">150</span><span class="w"> </span>--num_max_rounds_filtering<span class="o">=</span><span class="m">5</span><span class="w"> </span>--enable_dask_cuda_cluster<span class="w"> </span>--persist_intermediate_files<span class="w"> </span>--output_path<span class="o">=</span><span class="nv">$OUT_DATASET_PATH</span><span class="w"> </span>--categorical_features<span class="o">=</span>user_id,item_id,video_category,gender,age<span class="w"> </span>--binary_classif_targets<span class="o">=</span>click,follow,like,share<span class="w"> </span>--regression_targets<span class="o">=</span>watching_times<span class="w"> </span>--to_int32<span class="o">=</span>user_id,item_id<span class="w"> </span>--to_int16<span class="o">=</span>watching_times<span class="w"> </span>--to_int8<span class="o">=</span>gender,age,video_category,click,follow,like,share<span class="w"> </span>--user_id_feature<span class="o">=</span>user_id<span class="w"> </span>--item_id_feature<span class="o">=</span>item_id<span class="w"> </span>--dataset_split_strategy<span class="o">=</span>random_by_user<span class="w"> </span>--random_split_eval_perc<span class="o">=</span><span class="m">0</span>.2
</pre></div>
</div>
<section id="inputs">
<h3>Inputs<a class="headerlink" href="#inputs" title="Permalink to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">data_path</span>
                        <span class="n">Path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">data</span>
  <span class="o">--</span><span class="n">eval_data_path</span> 
                        <span class="n">Path</span> <span class="n">to</span> <span class="nb">eval</span> <span class="n">data</span><span class="p">,</span> <span class="k">if</span> <span class="n">data</span> <span class="n">was</span> <span class="n">already</span> <span class="n">splitMust</span> <span class="n">have</span>
                        <span class="n">the</span> <span class="n">same</span> <span class="n">schema</span> <span class="k">as</span> <span class="n">train</span> <span class="n">data</span> <span class="p">(</span><span class="ow">in</span> <span class="o">--</span><span class="n">data_path</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">predict_data_path</span> 
                        <span class="n">Path</span> <span class="n">to</span> <span class="n">data</span> <span class="n">to</span> <span class="n">be</span> <span class="n">preprocessed</span> <span class="k">for</span> <span class="n">prediction</span><span class="o">.</span>
                        <span class="n">This</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="n">have</span> <span class="n">the</span> <span class="n">same</span> <span class="nb">input</span> <span class="n">features</span> <span class="k">as</span> 
                        <span class="n">train</span> <span class="n">data</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">targets</span><span class="p">,</span> <span class="k">as</span> <span class="n">this</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">used</span> <span class="k">for</span> <span class="n">prediction</span><span class="o">.</span>
  <span class="o">--</span><span class="n">input_data_format</span> <span class="p">{</span><span class="n">csv</span><span class="p">,</span><span class="n">tsv</span><span class="p">,</span><span class="n">parquet</span><span class="p">}</span>
                        <span class="n">Input</span> <span class="n">data</span> <span class="nb">format</span>
  <span class="o">--</span><span class="n">csv_sep</span>             <span class="n">Character</span> <span class="n">separator</span> <span class="k">for</span> <span class="n">CSV</span> <span class="n">files</span><span class="o">.</span><span class="n">Default</span> <span class="ow">is</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span> <span class="n">You</span>
                        <span class="n">can</span> <span class="n">use</span> <span class="s1">&#39;tab&#39;</span> <span class="k">for</span> <span class="n">tabular</span> <span class="n">separated</span> <span class="n">data</span><span class="p">,</span> <span class="ow">or</span>
                        <span class="o">--</span><span class="n">input_data_format</span> <span class="n">tsv</span>
  <span class="o">--</span><span class="n">csv_na_values</span> 
                        <span class="n">String</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">original</span> <span class="n">data</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">replaced</span> <span class="n">by</span>
                        <span class="n">NULL</span>
</pre></div>
</div>
</section>
<section id="outputs">
<h3>Outputs<a class="headerlink" href="#outputs" title="Permalink to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">output_path</span> 
                        <span class="n">Output</span> <span class="n">path</span> <span class="n">where</span> <span class="n">the</span> <span class="n">preprocessed</span> <span class="n">files</span> <span class="n">will</span> <span class="n">be</span>
                        <span class="n">savedDefault</span> <span class="ow">is</span> <span class="o">./</span><span class="n">results</span><span class="o">/</span>
  <span class="o">--</span><span class="n">output_num_partitions</span> 
                        <span class="n">Number</span> <span class="n">of</span> <span class="n">partitions</span> <span class="n">that</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">number</span> <span class="n">of</span>
                        <span class="n">output</span> <span class="n">filesDefault</span> <span class="ow">is</span> <span class="mf">10.</span>
  <span class="o">--</span><span class="n">persist_intermediate_files</span> 
                        <span class="n">Whether</span> <span class="n">to</span> <span class="n">persist</span><span class="o">/</span><span class="n">cache</span> <span class="n">the</span> <span class="n">intermediate</span>
                        <span class="n">preprocessing</span> <span class="n">files</span><span class="o">.</span> <span class="n">Enabling</span> <span class="n">this</span> <span class="n">might</span> <span class="n">be</span> <span class="n">necessary</span>
                        <span class="k">for</span> <span class="n">larger</span> <span class="n">datasets</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="features-and-targets-definition">
<h3>Features and targets definition<a class="headerlink" href="#features-and-targets-definition" title="Permalink to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">control_features</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">separated</span><span class="p">)</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">kept</span> <span class="k">as</span> <span class="ow">is</span> <span class="ow">in</span>
                        <span class="n">the</span> <span class="n">output</span> <span class="n">files</span><span class="o">.</span> <span class="n">For</span> <span class="n">example</span><span class="p">,</span>
                        <span class="o">--</span><span class="n">control_features</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span><span class="n">timestamp</span>
  <span class="o">--</span><span class="n">categorical_features</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="k">with</span> <span class="n">categorical</span><span class="o">/</span><span class="n">discrete</span> <span class="n">features</span>
                        <span class="n">that</span> <span class="n">will</span> <span class="n">encoded</span><span class="o">/</span><span class="n">categorified</span> <span class="n">to</span> <span class="n">contiguous</span> <span class="n">ids</span> <span class="ow">in</span>
                        <span class="n">the</span> <span class="n">preprocessing</span><span class="o">.</span> <span class="n">These</span> <span class="n">tags</span> <span class="n">are</span> <span class="n">tagged</span> <span class="k">as</span>
                        <span class="s1">&#39;categorical&#39;</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">schema</span><span class="p">,</span> <span class="n">so</span> <span class="n">that</span> <span class="n">Merlin</span> <span class="n">Models</span> <span class="n">can</span>
                        <span class="n">automatically</span> <span class="n">create</span> <span class="n">embedding</span> <span class="n">tables</span> <span class="k">for</span> <span class="n">them</span><span class="o">.</span>
  <span class="o">--</span><span class="n">continuous_features</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="k">with</span> <span class="n">continuous</span> <span class="n">features</span> <span class="n">that</span> <span class="n">will</span>
                        <span class="n">be</span> <span class="n">standardized</span> <span class="ow">and</span> <span class="n">tagged</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">schema</span> <span class="k">as</span>
                        <span class="s1">&#39;continuous&#39;</span><span class="p">,</span> <span class="n">so</span> <span class="n">that</span> <span class="n">the</span> <span class="n">Merlin</span> <span class="n">Models</span> <span class="n">can</span> <span class="n">represent</span>
                        <span class="ow">and</span> <span class="n">combine</span> <span class="n">them</span> <span class="k">with</span> <span class="n">embedding</span> <span class="n">properly</span><span class="o">.</span>
  <span class="o">--</span><span class="n">continuous_features_fillna</span> 
                        <span class="n">Replaces</span> <span class="n">NULL</span> <span class="n">values</span> <span class="k">with</span> <span class="n">this</span> <span class="nb">float</span><span class="o">.</span> <span class="n">You</span> <span class="n">can</span> <span class="n">also</span> <span class="nb">set</span>
                        <span class="n">it</span> <span class="k">with</span> <span class="s1">&#39;median&#39;</span> <span class="k">for</span> <span class="n">filling</span> <span class="n">nulls</span> <span class="k">with</span> <span class="n">the</span> <span class="n">median</span>
                        <span class="n">value</span><span class="o">.</span>
  <span class="o">--</span><span class="n">user_features</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">tagged</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">schema</span> <span class="k">as</span> <span class="n">user</span> <span class="n">features</span><span class="o">.</span> <span class="n">This</span> <span class="n">information</span> <span class="n">might</span> <span class="n">be</span>
                        <span class="n">useful</span> <span class="k">for</span> <span class="n">modeling</span> <span class="n">later</span><span class="o">.</span>
  <span class="o">--</span><span class="n">item_features</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">tagged</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">schema</span> <span class="k">as</span> <span class="n">item</span> <span class="n">features</span><span class="o">.</span> <span class="n">This</span> <span class="n">information</span> <span class="n">might</span> <span class="n">be</span>
                        <span class="n">useful</span> <span class="k">for</span> <span class="n">modeling</span> <span class="n">later</span><span class="p">,</span> <span class="k">for</span> <span class="n">example</span><span class="p">,</span> <span class="k">for</span> <span class="ow">in</span><span class="o">-</span><span class="n">batch</span>
                        <span class="n">sampling</span> <span class="k">if</span> <span class="n">your</span> <span class="n">data</span> <span class="n">contains</span> <span class="n">only</span> <span class="n">positive</span> <span class="n">examples</span><span class="o">.</span>
  <span class="o">--</span><span class="n">user_id_feature</span> 
                        <span class="n">Column</span> <span class="n">that</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">user</span> <span class="nb">id</span> <span class="n">feature</span><span class="p">,</span> <span class="k">for</span> <span class="n">tagging</span>
                        <span class="ow">in</span> <span class="n">the</span> <span class="n">schema</span><span class="o">.</span> <span class="n">This</span> <span class="n">information</span> <span class="ow">is</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">preprocessing</span> <span class="k">if</span> <span class="n">you</span> <span class="nb">set</span> <span class="o">--</span><span class="n">min_user_freq</span> <span class="ow">or</span>
                        <span class="o">--</span><span class="n">max_user_freq</span>
  <span class="o">--</span><span class="n">item_id_feature</span> 
                        <span class="n">Column</span> <span class="n">that</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">item</span> <span class="nb">id</span> <span class="n">feature</span><span class="p">,</span> <span class="k">for</span> <span class="n">tagging</span>
                        <span class="ow">in</span> <span class="n">the</span> <span class="n">schema</span><span class="o">.</span> <span class="n">This</span> <span class="n">information</span> <span class="ow">is</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">preprocessing</span> <span class="k">if</span> <span class="n">you</span> <span class="nb">set</span> <span class="o">--</span><span class="n">min_item_freq</span> <span class="ow">or</span>
                        <span class="o">--</span><span class="n">max_item_freq</span>
  <span class="o">--</span><span class="n">timestamp_feature</span> 
                        <span class="n">Column</span> <span class="n">containing</span> <span class="n">a</span> <span class="n">timestamp</span> <span class="ow">or</span> <span class="n">date</span> <span class="n">feature</span><span class="o">.</span> <span class="n">The</span>
                        <span class="n">basic</span> <span class="n">preprocessing</span> <span class="n">doesn</span><span class="s1">&#39;t extracts date and time</span>
                        <span class="n">features</span> <span class="k">for</span> <span class="n">it</span><span class="o">.</span> <span class="n">It</span> <span class="ow">is</span> <span class="n">just</span> <span class="n">tagged</span> <span class="k">as</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span>
                        <span class="n">the</span> <span class="n">schema</span> <span class="ow">and</span> <span class="n">used</span> <span class="k">for</span> <span class="n">splitting</span> <span class="n">train</span> <span class="o">/</span> <span class="nb">eval</span> <span class="n">data</span> <span class="k">if</span>
                        <span class="o">--</span><span class="n">dataset_split_strategy</span><span class="o">=</span><span class="n">temporal</span> <span class="ow">is</span> <span class="n">used</span><span class="o">.</span>
  <span class="o">--</span><span class="n">session_id_feature</span> <span class="n">SESSION_ID_FEATURE</span>
                        <span class="n">This</span> <span class="ow">is</span> <span class="n">just</span> <span class="k">for</span> <span class="n">tagging</span> <span class="n">this</span> <span class="n">feature</span><span class="o">.</span>
  <span class="o">--</span><span class="n">binary_classif_targets</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">tagged</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">schema</span> <span class="k">as</span> <span class="n">binary</span> <span class="n">target</span><span class="o">.</span> <span class="n">Merlin</span> <span class="n">Models</span> <span class="n">will</span> <span class="n">create</span> <span class="n">a</span>
                        <span class="n">binary</span> <span class="n">classification</span> <span class="n">head</span> <span class="k">for</span> <span class="n">each</span> <span class="n">of</span> <span class="n">these</span> <span class="n">targets</span><span class="o">.</span>
  <span class="o">--</span><span class="n">regression_targets</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">tagged</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">schema</span> <span class="k">as</span> <span class="n">binary</span> <span class="n">target</span><span class="o">.</span> <span class="n">Merlin</span> <span class="n">Models</span> <span class="n">will</span> <span class="n">create</span> <span class="n">a</span>
                        <span class="n">regression</span> <span class="n">head</span> <span class="k">for</span> <span class="n">each</span> <span class="n">of</span> <span class="n">these</span> <span class="n">targets</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="target-encoding-features">
<h3>Target encoding features<a class="headerlink" href="#target-encoding-features" title="Permalink to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  --target_encoding_features 
                        Columns (comma-sep) with categorical/discrete
                        features for which target encoding features will be
                        generated, with the average of the target columns
                        for each categorical value. The target columns are
                        defined in --target_encoding_targets. If
                        --target_encoding_features is not provided but
                        --target_encoding_targets is, all categorical
                        features will be used.
  --target_encoding_targets 
                        Columns (comma-sep) with target columns that will be
                        used to compute target encoding features with the
                        average of the target columns for categorical
                        features value. The categorical features are defined
                        in --target_encoding_features. If
                        --target_encoding_targets is not provided but
                        --target_encoding_features is, all target columns
                        will be used.
  --target_encoding_kfold 
                        Number of folds for target encoding, in order to
                        avoid that the current example is considered in the
                        target encoding feature computation, which could
                        cause overfitting for infrequent categorical values.
                        Default is 5
  --target_encoding_smoothing 
                        Smoothing factor that is used in the target encoding
                        computation, as statistics for infrequent
                        categorical values might be noisy. It makes target
                        encoding formula = `sum_target_per_categ_value +
                        (global_target_avg * smooth) / categ_value_count +
                        smooth`. Default is 10

</pre></div>
</div>
</section>
<section id="data-casting-and-filtering">
<h3>Data casting and filtering<a class="headerlink" href="#data-casting-and-filtering" title="Permalink to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">to_int32</span>            <span class="n">Cast</span> <span class="n">these</span> <span class="n">columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">to</span> <span class="n">int32</span><span class="o">.</span>
  <span class="o">--</span><span class="n">to_int16</span>            <span class="n">Cast</span> <span class="n">these</span> <span class="n">columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">to</span> <span class="n">int16</span><span class="p">,</span> <span class="n">to</span> <span class="n">save</span> <span class="n">some</span>
                        <span class="n">memory</span><span class="o">.</span>
  <span class="o">--</span><span class="n">to_int8</span>             <span class="n">Cast</span> <span class="n">these</span> <span class="n">columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">to</span> <span class="n">int32</span><span class="p">,</span> <span class="n">to</span> <span class="n">save</span> <span class="n">some</span>
                        <span class="n">memory</span><span class="o">.</span>
  <span class="o">--</span><span class="n">to_float32</span> 
                        <span class="n">Cast</span> <span class="n">these</span> <span class="n">columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">to</span> <span class="n">float32</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="filtering-and-frequency-capping">
<h1>Filtering and frequency capping<a class="headerlink" href="#filtering-and-frequency-capping" title="Permalink to this heading">#</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  --categ_min_freq_capping
                        Value used for min frequency capping. If greater than 0, all categorical values which are less frequent than this threshold will be mapped to the null value encoded id.
                        
  --min_user_freq 
                        Users with frequency lower than this value are removed
                        from the dataset (before data splitting).
  --max_user_freq 
                        Users with frequency higher than this value are
                        removed from the dataset (before data splitting).
  --min_item_freq 
                        Items with frequency lower than this value are removed
                        from the dataset (before data splitting).
  --max_item_freq 
                        Items with frequency higher than this value are
                        removed from the dataset (before data splitting).
  --num_max_rounds_filtering 
                        Max number of rounds interleaving users and items
                        frequency filtering. If a small number of rounds is
                        chosen, some low-frequent users or items might be kept
                        in the dataset. Default is 5
  --filter_query 
                        A filter query condition compatible with dask-cudf
                        `DataFrame.query()`
</pre></div>
</div>
<section id="dataset-splitting-train-and-eval-sets">
<h2>Dataset splitting (train and eval sets)<a class="headerlink" href="#dataset-splitting-train-and-eval-sets" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">dataset_split_strategy</span> <span class="p">{</span><span class="n">random</span><span class="p">,</span><span class="n">random_by_user</span><span class="p">,</span><span class="n">temporal</span><span class="p">}</span>
                        <span class="n">If</span> <span class="kc">None</span><span class="p">,</span> <span class="n">no</span> <span class="n">data</span> <span class="n">split</span> <span class="ow">is</span> <span class="n">performed</span><span class="o">.</span> <span class="n">If</span> <span class="s1">&#39;random&#39;</span><span class="p">,</span>
                        <span class="n">samples</span> <span class="n">are</span> <span class="n">assigned</span> <span class="n">randomly</span> <span class="n">to</span> <span class="nb">eval</span> <span class="nb">set</span> <span class="n">according</span> <span class="n">to</span>
                        <span class="o">--</span><span class="n">random_split_eval_perc</span><span class="o">.</span> <span class="n">If</span> <span class="s1">&#39;random_by_user&#39;</span><span class="p">,</span> <span class="n">users</span>
                        <span class="n">will</span> <span class="n">have</span> <span class="n">examples</span> <span class="ow">in</span> <span class="n">both</span> <span class="n">train</span> <span class="ow">and</span> <span class="nb">eval</span> <span class="nb">set</span><span class="p">,</span>
                        <span class="n">according</span> <span class="n">to</span> <span class="n">the</span> <span class="n">proportion</span> <span class="n">specified</span> <span class="ow">in</span>
                        <span class="o">--</span><span class="n">random_split_eval_perc</span><span class="o">.</span> <span class="n">If</span> <span class="s1">&#39;temporal&#39;</span><span class="p">,</span> <span class="n">the</span>
                        <span class="o">--</span><span class="n">timestamp_feature</span> <span class="k">with</span>
                        <span class="o">--</span><span class="n">dataset_split_temporal_timestamp</span> <span class="n">to</span> <span class="n">split</span> <span class="nb">eval</span> <span class="nb">set</span>
                        <span class="n">based</span> <span class="n">on</span> <span class="n">time</span><span class="o">.</span>
  <span class="o">--</span><span class="n">random_split_eval_perc</span> 
                        <span class="n">Percentage</span> <span class="n">of</span> <span class="n">examples</span> <span class="n">to</span> <span class="n">be</span> <span class="n">assigned</span> <span class="n">to</span> <span class="nb">eval</span> <span class="nb">set</span><span class="o">.</span> <span class="n">It</span>
                        <span class="ow">is</span> <span class="n">used</span> <span class="k">with</span> <span class="o">--</span><span class="n">dataset_split_strategy</span> <span class="s1">&#39;random&#39;</span> <span class="ow">and</span>
                        <span class="s1">&#39;random_by_user&#39;</span>
  <span class="o">--</span><span class="n">dataset_split_temporal_timestamp</span> 
                        <span class="n">Used</span> <span class="n">when</span> <span class="o">--</span><span class="n">dataset_split_strategy</span> <span class="s1">&#39;temporal&#39;</span><span class="o">.</span> <span class="n">It</span>
                        <span class="n">assigns</span> <span class="k">for</span> <span class="nb">eval</span> <span class="nb">set</span> <span class="nb">all</span> <span class="n">examples</span> <span class="n">where</span> <span class="n">the</span>
                        <span class="o">--</span><span class="n">timestamp_feature</span> <span class="o">&gt;=</span> <span class="n">value</span>
</pre></div>
</div>
</section>
<section id="cuda-cluster-options">
<h2>CUDA cluster options<a class="headerlink" href="#cuda-cluster-options" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">enable_dask_cuda_cluster</span>
                        <span class="n">Initializes</span> <span class="n">a</span> <span class="n">LocalCUDACluster</span> <span class="k">for</span> <span class="n">multi</span><span class="o">-</span><span class="n">GPU</span> <span class="n">preprocessing</span><span class="o">.</span>
                        <span class="n">This</span> <span class="ow">is</span> <span class="n">recommended</span> <span class="k">for</span> <span class="n">larger</span> <span class="n">dataset</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span>
                        <span class="n">errors</span><span class="p">,</span> <span class="n">when</span> <span class="n">multiple</span> <span class="n">GPUs</span> <span class="n">are</span> <span class="n">available</span><span class="o">.</span> <span class="n">By</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">False</span><span class="o">.</span>
  <span class="o">--</span><span class="n">dask_cuda_visible_gpu_devices</span> 
                        <span class="n">Ids</span> <span class="n">of</span> <span class="n">GPU</span> <span class="n">devices</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span>
                        <span class="n">preprocessing</span><span class="p">,</span> <span class="k">if</span> <span class="nb">any</span><span class="o">.</span> <span class="n">For</span> <span class="n">example</span><span class="p">:</span>
                        <span class="o">--</span><span class="n">visible_gpu_devices</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span> <span class="n">Default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="k">for</span> <span class="n">using</span> <span class="nb">all</span> <span class="n">GPUs</span>
  <span class="o">--</span><span class="n">dask_cuda_gpu_device_spill_frac</span> 
                        <span class="n">Percentage</span> <span class="n">of</span> <span class="n">GPU</span> <span class="n">memory</span> <span class="n">used</span> <span class="n">at</span> <span class="n">which</span>
                        <span class="n">LocalCUDACluster</span> <span class="n">should</span> <span class="n">spill</span> <span class="n">memory</span> <span class="n">to</span> <span class="n">CPU</span><span class="p">,</span> <span class="n">before</span>
                        <span class="n">raising</span> <span class="n">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span> <span class="n">errors</span><span class="o">.</span> <span class="n">Default</span> <span class="ow">is</span> <span class="mf">0.7</span>
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Preprocessing script</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#best-practices">Best practices</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-task">Defining the task</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-features">Preprocessing features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-high-cardinality-data">Dealing with high-cardinality data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering">Feature Engineering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-set-splitting">Data set splitting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#command-line-arguments">Command line arguments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs">Inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs">Outputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#features-and-targets-definition">Features and targets definition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#target-encoding-features">Target encoding features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-casting-and-filtering">Data casting and filtering</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-and-frequency-capping">Filtering and frequency capping</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-splitting-train-and-eval-sets">Dataset splitting (train and eval sets)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cuda-cluster-options">CUDA cluster options</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023–2024, NVIDIA.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p>
<a href="https://www.nvidia.com/en-us/about-nvidia/privacy-policy/" target="_blank">Privacy Policy</a> |
<a href="https://www.nvidia.com/en-us/about-nvidia/privacy-center/" target="_blank">Manage My Privacy</a> |
<a href="https://www.nvidia.com/en-us/preferences/start/" target="_blank">Do Not Sell or Share My Data</a> |
<a href="https://www.nvidia.com/en-us/about-nvidia/terms-of-service/" target="_blank">Terms of Service</a> |
<a href="https://www.nvidia.com/en-us/about-nvidia/accessibility/" target="_blank">Accessibility</a> |
<a href="https://www.nvidia.com/en-us/about-nvidia/company-policies/" target="_blank">Corporate Policies</a> |
<a href="https://www.nvidia.com/en-us/product-security/" target="_blank">Product Security</a> |
<a href="https://www.nvidia.com/en-us/contact/" target="_blank">Contact</a>
</p>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>