<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Preprocessing script &mdash; Merlin  documentation</title><link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/mystnb.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
    <link rel="canonical" href="https://nvidia-merlin.github.io/Merlin/main/examples/quick_start/scripts/preproc/index.html" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script >let toggleHintShow = 'Click to show';</script>
        <script >let toggleHintHide = 'Click to hide';</script>
        <script >let toggleOpenOnPrint = 'true';</script>
        <script src="../../../../_static/togglebutton.js"></script>
        <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">
  <div class="banner">
    <p class="banner">
      Beginning in January 2023, versions for all NVIDIA Merlin projects
      will change from semantic versioning like <code>4.0</code>
      to calendar versioning like <code>23.01</code>.</p>
  </div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Merlin
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Example Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../containers.html">Merlin Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../support_matrix/index.html">Merlin Support Matrix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Merlin</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Preprocessing script</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="preprocessing-script">
<h1>Preprocessing script<a class="headerlink" href="#preprocessing-script" title="Permalink to this headline"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">preprocessing.py</span></code> is a template script that provides basic preprocessing and feature engineering operations for tabular data, so that they are better represented for neural models. It uses the <a class="reference external" href="https://github.com/NVIDIA-Merlin/NVTabular">NVTabular</a> and <a class="reference external" href="https://github.com/rapidsai/cudf/tree/main/python/dask_cudf">dask-cudf</a> libraries for GPU accelerated preprocessing.</p>
<p>In this document we describe the provided preprocessing and feature engineering options and the corresponding command line arguments.</p>
<div class="section" id="best-practices">
<h2>Best practices<a class="headerlink" href="#best-practices" title="Permalink to this headline"></a></h2>
<p>In this section we list some best practices on preprocessing and feature engineering for preparing data for neural models.</p>
<div class="section" id="dataset">
<h3>Dataset<a class="headerlink" href="#dataset" title="Permalink to this headline"></a></h3>
<p>The typical data to train recommender systems is the <strong>log of user interactions</strong> on items from a platform like e-commerce, news portal, social network, ad network, streaming media platform, among others.
In addition to users interactions.
The logged users interaction might contain explicit feedback from users, e.g. like, dislike, rating, or implicit feedback events, e.g. click, comment, add-to-cart, purchase, which might be positive or negative, e.g. items shown to the user and ignored.</p>
</div>
<div class="section" id="defining-the-task">
<h3>Defining the task<a class="headerlink" href="#defining-the-task" title="Permalink to this headline"></a></h3>
<p>You need to prepare the dataset according to the desired task.</p>
<p><strong>Retrieval</strong> - The model objective is to return for a given user the top-k recommended items. In this case, the data can contain only positive interactions as retrieval models are typically trained using negative sampling from other users interactions, not requiring implicit negatives.</p>
<p><strong>Ranking</strong> - The model objective is to score the relevance of a target item for a given user. In this case, you have at least one target column that express implicit or explicit your feedback you want to predict. Typically each target will be used by either a binary classification (e.g. predicting binary events like click, <code class="docutils literal notranslate"><span class="pre">--binary_classif_targets</span></code>) or regression task (e.g. estimating rating, <code class="docutils literal notranslate"><span class="pre">--regression_targets</span></code>). You can see below an example of the TenRec dataset that is suitable for ranking.</p>
<p><img alt="TenRec dataset structure" src="../../../../_images/tenrec_dataset.png" /></p>
</div>
<div class="section" id="preprocessing-features">
<h3>Preprocessing features<a class="headerlink" href="#preprocessing-features" title="Permalink to this headline"></a></h3>
<p>When preparing the data, you need to include features that are relevant for predicting a user interaction, which might include user features that are static (e.g. user id, age, gender), dynamic contextual features (e.g. location, device) and item features (e.g. item id, category, price).<br />
For neural networks there is an important distinction between categorical and continuous features.</p>
<p><strong>Continuous features</strong><br />
Continuous features (<code class="docutils literal notranslate"><span class="pre">--continuous_features</span></code>) are naturally fed into neural networks, they typically just need need to be normalized to avoid numerical scaling issues. Typical approaches for normalizing continuous features are <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.Normalize.html#nvtabular.ops.Normalize">standardization (Z-scaling)</a> and <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.NormalizeMinMax.html#nvtabular.ops.NormalizeMinMax">min-max scaling</a>.
It is important to have a strategy for imputation of missing values (e.g. with a constant <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.FillMissing.html#nvtabular.ops.FillMissing">float</a>, or some statistic like mean or <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.FillMedian.html#nvtabular.ops.FillMedian">median</a>), as null (NaN) values are not acceptable as input by neural networks.</p>
<p><strong>Categorical features</strong><br />
Categorical features (<code class="docutils literal notranslate"><span class="pre">--categorical_features</span></code>) are nominal data, which  typically strings or id numbers that don’t have any meaningful order or scaling properties. They are typically <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.Categorify.html#nvtabular.ops.Categorify">categorified</a> / represented as continuous ids, so that when fed to a model they can be represented either as one-hot representation for linear models or embedded for neural networks.</p>
</div>
<div class="section" id="dealing-with-high-cardinality-data">
<h3>Dealing with high-cardinality data<a class="headerlink" href="#dealing-with-high-cardinality-data" title="Permalink to this headline"></a></h3>
<p>Large services might have categorical features with very high cardinality (e.g. order of hundreds of millions or higher), like user id or item id. They typically require a high memory to be stored (e.g. with embedding tables) or processed (e.g. with one-hot encoding). In addition, most of the categorical values are very infrequent, for which it is not possible to learn good embeddings. Thus, your make some modeling choices in order to preprocess those categorical features accordingly. Here are some options:</p>
<ul class="simple">
<li><p><strong>Keep the original high-cardinality</strong> - If you are going use a model with distributed embedding solution, that will support sharding the embedding table across multiple devices(typically GPUs) to avoid going out-of-memory, then you can categorify the features just as you do for low-cardinality ones.</p></li>
<li><p><strong>Frequency capping</strong> (<code class="docutils literal notranslate"><span class="pre">--categ_min_freq_capping</span></code>)- Infrequent values are mapped to 0, forming a cluster of infrequent / cold-start users/items that can be useful for training the model to deal with them.</p></li>
<li><p><strong>Filtering out infrequent values</strong> (<code class="docutils literal notranslate"><span class="pre">--min_user_freq</span></code>, <code class="docutils literal notranslate"><span class="pre">--min_item_freq</span></code>) - You might <em>filter out</em> interactions from infrequent or fresh users or items, which are typically the majority of systems interactions as they typically follow the long-tail distribution.</p></li>
<li><p><strong>Hashing</strong> - An additional option is to hash the categorical values into a number of buckets much lower than the feature cardinality. That way, you introduce collisions as a trade-off for lower final cardinality and memory requirements in the modeling side. This can be in the <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.HashBucket.html#nvtabular.ops.HashBucket">preprocessing</a> or in the modeling.</p></li>
</ul>
</div>
<div class="section" id="feature-engineering">
<h3>Feature Engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this headline"></a></h3>
<p>Feature engineering allows designing new features from raw data that are can provide useful information to the model with respect to the prediction task.</p>
<p>In this section we list common feature engineering techniques. Most of them are implemented as <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/api.html#categorical-operators">ops</a> in <a class="reference external" href="https://github.com/NVIDIA-Merlin/NVTabular">NVTabular</a>. User defined functions (UDF) can be implemented with <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.LambdaOp.html#nvtabular.ops.LambdaOp">Lambda</a> op, which are very useful for example for dealing with temporal and geographic feature engineering.</p>
<p>This preprocessing script provides just basic feature engineering. For more using those more advanced techniques you can copy the <code class="docutils literal notranslate"><span class="pre">preprocessing.py</span></code> script and add them to the NVTabular workflow within <code class="docutils literal notranslate"><span class="pre">generate_nvt_workflow_features()</span></code>.</p>
<p><strong>Continuous features</strong></p>
<ul class="simple">
<li><p>Smoothing long-tailed distributions of continuous features with <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.LogOp.html#nvtabular.ops.LogOp">Log</a>, so that the range of large numbers is compressed and the range of small numbers is expanded.</p></li>
<li><p>Continuous features can be represented as categorical features by either binarization (converting to binary) or <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.Bucketize.html#nvtabular.ops.Bucketize">binning</a> (converting to multiple categorical or ordinal values). That might be useful to group together values that are similar, e.g., periods of the day, age ranges of users, etc.</p></li>
</ul>
<p><strong>Categorical features</strong></p>
<ul class="simple">
<li><p>Besides contiguous ids, categorical features can be also represented by global statistics of their values, or by statistics conditioned in other columns. Some popular techniques are:</p>
<ul>
<li><p><strong>Count encoding</strong> - represents the count of a given categorical value across the whole dataset (e.g. count of user past interactions)</p></li>
<li><p><strong>Target encoding</strong> - represents one statistic of a categorical column conditioned on a target column. One example would be computing the average of click binary target segmented by the item id categorical values, which represents its Click-Through Rate (CTR) or likelihood to be clicked by a random user. <a class="reference external" href="https://nvidia-merlin.github.io/NVTabular/v23.02.00/generated/nvtabular.ops.TargetEncoding.html#nvtabular.ops.TargetEncoding"><em>Target encoding</em></a> is a very powerful feature engineering technique, and has been a key for many of our <a class="reference external" href="https://medium.com/rapids-ai/winning-solution-of-recsys2020-challenge-gpu-accelerated-feature-engineering-and-training-for-cd67c5a87b1f">winning solutions</a> for RecSys competitions.</p></li>
</ul>
</li>
</ul>
<p><strong>Temporal features</strong></p>
<ul class="simple">
<li><p>Extracting temporal features from timestamps, like day of week, day, month, year, quarter, hour, period of the day, among others.</p></li>
<li><p>Compute the “age” of the item or how long the user is active in the system, e.g. by subtracting the interaction timestamp by the timestamp when the user/item were seen for the first time.</p></li>
<li><p>Trending features might also be useful: for example, including continuous features that accumulates the user engagement in a specific category of product the last month, quarter, semester.</p></li>
</ul>
<p><strong>Geographic features</strong></p>
<ul class="simple">
<li><p>You can treat Zip codes, cities, states, countries as categorical features</p></li>
<li><p>If latitude/longitude are available, you can also compute distances, e.g. the distance between a hotel (item) location and the user location / airport / touristic landmark.</p></li>
<li><p>You can also enrich adding features based on external geolocation data (e.g. from census or government).,</p></li>
</ul>
</div>
<div class="section" id="data-set-splitting">
<h3>Data set splitting<a class="headerlink" href="#data-set-splitting" title="Permalink to this headline"></a></h3>
<p>There are many approaches for splitting (<code class="docutils literal notranslate"><span class="pre">--dataset_split_strategy</span></code>) train and evaluation data:</p>
<ul class="simple">
<li><p><strong>random</strong> - Examples are randomly assigned to train and eval sets (according to a percentage, <code class="docutils literal notranslate"><span class="pre">--random_split_eval_perc</span></code>).</p></li>
<li><p><strong>random by user</strong> - It is like random but stratified by user.Ensures that users have examples in both train and eval sets. This approach doesn’t provide cold-start users on eval set.</p></li>
<li><p><strong>temporal</strong> - Uses a reference timestamp (<code class="docutils literal notranslate"><span class="pre">--dataset_split_temporal_timestamp</span></code>) to split train and eval sets. Typically this is the most realistic approach, as when deployed models will not have access to future information when performing predictions.</p></li>
</ul>
</div>
</div>
<div class="section" id="command-line-arguments">
<h2>Command line arguments<a class="headerlink" href="#command-line-arguments" title="Permalink to this headline"></a></h2>
<p>In this section we describe the command line arguments of the preprocessing script.</p>
<p>The input and format can be CSV, TSV or Parquet, but the latter is recommended for being a columnar format which is faster to preprocess. Output preprocessing format is parquet format.</p>
<blockquote>
<div><p>You can check how to <a class="reference internal" href="../../ranking.html"><span class="doc std std-doc">setup the Docker container</span></a> to run <code class="docutils literal notranslate"><span class="pre">preprocessing.py</span></code> script with Docker.</p>
</div></blockquote>
<p>Here is an example command line for running preprocessing for the TenRec dataset in our Docker image, which is explained <a class="reference internal" href="../../ranking.html"><span class="doc std std-doc">here</span></a>.
The parameters and their values can be separated by either space or by <code class="docutils literal notranslate"><span class="pre">=</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/Merlin/examples/quick_start/scripts/preproc/
<span class="nv">OUT_DATASET_PATH</span><span class="o">=</span>/outputs/dataset
python<span class="w"> </span>preprocessing.py<span class="w"> </span>--input_data_format<span class="o">=</span>csv<span class="w"> </span>--csv_na_values<span class="o">=</span><span class="se">\\</span>N<span class="w"> </span>--data_path<span class="w"> </span>/data/QK-video.csv<span class="w"> </span>--filter_query<span class="o">=</span><span class="s2">&quot;click==1 or (click==0 and follow==0 and like==0 and share==0)&quot;</span><span class="w"> </span>--min_item_freq<span class="o">=</span><span class="m">30</span><span class="w"> </span>--min_user_freq<span class="o">=</span><span class="m">30</span><span class="w"> </span>--max_user_freq<span class="o">=</span><span class="m">150</span><span class="w"> </span>--num_max_rounds_filtering<span class="o">=</span><span class="m">5</span><span class="w"> </span>--enable_dask_cuda_cluster<span class="w"> </span>--persist_intermediate_files<span class="w"> </span>--output_path<span class="o">=</span><span class="nv">$OUT_DATASET_PATH</span><span class="w"> </span>--categorical_features<span class="o">=</span>user_id,item_id,video_category,gender,age<span class="w"> </span>--binary_classif_targets<span class="o">=</span>click,follow,like,share<span class="w"> </span>--regression_targets<span class="o">=</span>watching_times<span class="w"> </span>--to_int32<span class="o">=</span>user_id,item_id<span class="w"> </span>--to_int16<span class="o">=</span>watching_times<span class="w"> </span>--to_int8<span class="o">=</span>gender,age,video_category,click,follow,like,share<span class="w"> </span>--user_id_feature<span class="o">=</span>user_id<span class="w"> </span>--item_id_feature<span class="o">=</span>item_id<span class="w"> </span>--dataset_split_strategy<span class="o">=</span>random_by_user<span class="w"> </span>--random_split_eval_perc<span class="o">=</span><span class="m">0</span>.2
</pre></div>
</div>
<div class="section" id="inputs">
<h3>Inputs<a class="headerlink" href="#inputs" title="Permalink to this headline"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">data_path</span>
                        <span class="n">Path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">data</span>
  <span class="o">--</span><span class="n">eval_data_path</span> 
                        <span class="n">Path</span> <span class="n">to</span> <span class="nb">eval</span> <span class="n">data</span><span class="p">,</span> <span class="k">if</span> <span class="n">data</span> <span class="n">was</span> <span class="n">already</span> <span class="n">splitMust</span> <span class="n">have</span>
                        <span class="n">the</span> <span class="n">same</span> <span class="n">schema</span> <span class="k">as</span> <span class="n">train</span> <span class="n">data</span> <span class="p">(</span><span class="ow">in</span> <span class="o">--</span><span class="n">data_path</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">predict_data_path</span> 
                        <span class="n">Path</span> <span class="n">to</span> <span class="n">data</span> <span class="n">to</span> <span class="n">be</span> <span class="n">preprocessed</span> <span class="k">for</span> <span class="n">prediction</span><span class="o">.</span>
                        <span class="n">This</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="n">have</span> <span class="n">the</span> <span class="n">same</span> <span class="nb">input</span> <span class="n">features</span> <span class="k">as</span> 
                        <span class="n">train</span> <span class="n">data</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">targets</span><span class="p">,</span> <span class="k">as</span> <span class="n">this</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">used</span> <span class="k">for</span> <span class="n">prediction</span><span class="o">.</span>
  <span class="o">--</span><span class="n">input_data_format</span> <span class="p">{</span><span class="n">csv</span><span class="p">,</span><span class="n">tsv</span><span class="p">,</span><span class="n">parquet</span><span class="p">}</span>
                        <span class="n">Input</span> <span class="n">data</span> <span class="nb">format</span>
  <span class="o">--</span><span class="n">csv_sep</span>             <span class="n">Character</span> <span class="n">separator</span> <span class="k">for</span> <span class="n">CSV</span> <span class="n">files</span><span class="o">.</span><span class="n">Default</span> <span class="ow">is</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span> <span class="n">You</span>
                        <span class="n">can</span> <span class="n">use</span> <span class="s1">&#39;tab&#39;</span> <span class="k">for</span> <span class="n">tabular</span> <span class="n">separated</span> <span class="n">data</span><span class="p">,</span> <span class="ow">or</span>
                        <span class="o">--</span><span class="n">input_data_format</span> <span class="n">tsv</span>
  <span class="o">--</span><span class="n">csv_na_values</span> 
                        <span class="n">String</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">original</span> <span class="n">data</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">replaced</span> <span class="n">by</span>
                        <span class="n">NULL</span>
</pre></div>
</div>
</div>
<div class="section" id="outputs">
<h3>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">output_path</span> 
                        <span class="n">Output</span> <span class="n">path</span> <span class="n">where</span> <span class="n">the</span> <span class="n">preprocessed</span> <span class="n">files</span> <span class="n">will</span> <span class="n">be</span>
                        <span class="n">savedDefault</span> <span class="ow">is</span> <span class="o">./</span><span class="n">results</span><span class="o">/</span>
  <span class="o">--</span><span class="n">output_num_partitions</span> 
                        <span class="n">Number</span> <span class="n">of</span> <span class="n">partitions</span> <span class="n">that</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">number</span> <span class="n">of</span>
                        <span class="n">output</span> <span class="n">filesDefault</span> <span class="ow">is</span> <span class="mf">10.</span>
  <span class="o">--</span><span class="n">persist_intermediate_files</span> 
                        <span class="n">Whether</span> <span class="n">to</span> <span class="n">persist</span><span class="o">/</span><span class="n">cache</span> <span class="n">the</span> <span class="n">intermediate</span>
                        <span class="n">preprocessing</span> <span class="n">files</span><span class="o">.</span> <span class="n">Enabling</span> <span class="n">this</span> <span class="n">might</span> <span class="n">be</span> <span class="n">necessary</span>
                        <span class="k">for</span> <span class="n">larger</span> <span class="n">datasets</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="features-and-targets-definition">
<h3>Features and targets definition<a class="headerlink" href="#features-and-targets-definition" title="Permalink to this headline"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">control_features</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">separated</span><span class="p">)</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">kept</span> <span class="k">as</span> <span class="ow">is</span> <span class="ow">in</span>
                        <span class="n">the</span> <span class="n">output</span> <span class="n">files</span><span class="o">.</span> <span class="n">For</span> <span class="n">example</span><span class="p">,</span>
                        <span class="o">--</span><span class="n">control_features</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span><span class="n">timestamp</span>
  <span class="o">--</span><span class="n">categorical_features</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="k">with</span> <span class="n">categorical</span><span class="o">/</span><span class="n">discrete</span> <span class="n">features</span>
                        <span class="n">that</span> <span class="n">will</span> <span class="n">encoded</span><span class="o">/</span><span class="n">categorified</span> <span class="n">to</span> <span class="n">contiguous</span> <span class="n">ids</span> <span class="ow">in</span>
                        <span class="n">the</span> <span class="n">preprocessing</span><span class="o">.</span> <span class="n">These</span> <span class="n">tags</span> <span class="n">are</span> <span class="n">tagged</span> <span class="k">as</span>
                        <span class="s1">&#39;categorical&#39;</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">schema</span><span class="p">,</span> <span class="n">so</span> <span class="n">that</span> <span class="n">Merlin</span> <span class="n">Models</span> <span class="n">can</span>
                        <span class="n">automatically</span> <span class="n">create</span> <span class="n">embedding</span> <span class="n">tables</span> <span class="k">for</span> <span class="n">them</span><span class="o">.</span>
  <span class="o">--</span><span class="n">continuous_features</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="k">with</span> <span class="n">continuous</span> <span class="n">features</span> <span class="n">that</span> <span class="n">will</span>
                        <span class="n">be</span> <span class="n">standardized</span> <span class="ow">and</span> <span class="n">tagged</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">schema</span> <span class="k">as</span>
                        <span class="s1">&#39;continuous&#39;</span><span class="p">,</span> <span class="n">so</span> <span class="n">that</span> <span class="n">the</span> <span class="n">Merlin</span> <span class="n">Models</span> <span class="n">can</span> <span class="n">represent</span>
                        <span class="ow">and</span> <span class="n">combine</span> <span class="n">them</span> <span class="k">with</span> <span class="n">embedding</span> <span class="n">properly</span><span class="o">.</span>
  <span class="o">--</span><span class="n">continuous_features_fillna</span> 
                        <span class="n">Replaces</span> <span class="n">NULL</span> <span class="n">values</span> <span class="k">with</span> <span class="n">this</span> <span class="nb">float</span><span class="o">.</span> <span class="n">You</span> <span class="n">can</span> <span class="n">also</span> <span class="nb">set</span>
                        <span class="n">it</span> <span class="k">with</span> <span class="s1">&#39;median&#39;</span> <span class="k">for</span> <span class="n">filling</span> <span class="n">nulls</span> <span class="k">with</span> <span class="n">the</span> <span class="n">median</span>
                        <span class="n">value</span><span class="o">.</span>
  <span class="o">--</span><span class="n">user_features</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">tagged</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">schema</span> <span class="k">as</span> <span class="n">user</span> <span class="n">features</span><span class="o">.</span> <span class="n">This</span> <span class="n">information</span> <span class="n">might</span> <span class="n">be</span>
                        <span class="n">useful</span> <span class="k">for</span> <span class="n">modeling</span> <span class="n">later</span><span class="o">.</span>
  <span class="o">--</span><span class="n">item_features</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">tagged</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">schema</span> <span class="k">as</span> <span class="n">item</span> <span class="n">features</span><span class="o">.</span> <span class="n">This</span> <span class="n">information</span> <span class="n">might</span> <span class="n">be</span>
                        <span class="n">useful</span> <span class="k">for</span> <span class="n">modeling</span> <span class="n">later</span><span class="p">,</span> <span class="k">for</span> <span class="n">example</span><span class="p">,</span> <span class="k">for</span> <span class="ow">in</span><span class="o">-</span><span class="n">batch</span>
                        <span class="n">sampling</span> <span class="k">if</span> <span class="n">your</span> <span class="n">data</span> <span class="n">contains</span> <span class="n">only</span> <span class="n">positive</span> <span class="n">examples</span><span class="o">.</span>
  <span class="o">--</span><span class="n">user_id_feature</span> 
                        <span class="n">Column</span> <span class="n">that</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">user</span> <span class="nb">id</span> <span class="n">feature</span><span class="p">,</span> <span class="k">for</span> <span class="n">tagging</span>
                        <span class="ow">in</span> <span class="n">the</span> <span class="n">schema</span><span class="o">.</span> <span class="n">This</span> <span class="n">information</span> <span class="ow">is</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">preprocessing</span> <span class="k">if</span> <span class="n">you</span> <span class="nb">set</span> <span class="o">--</span><span class="n">min_user_freq</span> <span class="ow">or</span>
                        <span class="o">--</span><span class="n">max_user_freq</span>
  <span class="o">--</span><span class="n">item_id_feature</span> 
                        <span class="n">Column</span> <span class="n">that</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">item</span> <span class="nb">id</span> <span class="n">feature</span><span class="p">,</span> <span class="k">for</span> <span class="n">tagging</span>
                        <span class="ow">in</span> <span class="n">the</span> <span class="n">schema</span><span class="o">.</span> <span class="n">This</span> <span class="n">information</span> <span class="ow">is</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">preprocessing</span> <span class="k">if</span> <span class="n">you</span> <span class="nb">set</span> <span class="o">--</span><span class="n">min_item_freq</span> <span class="ow">or</span>
                        <span class="o">--</span><span class="n">max_item_freq</span>
  <span class="o">--</span><span class="n">timestamp_feature</span> 
                        <span class="n">Column</span> <span class="n">containing</span> <span class="n">a</span> <span class="n">timestamp</span> <span class="ow">or</span> <span class="n">date</span> <span class="n">feature</span><span class="o">.</span> <span class="n">The</span>
                        <span class="n">basic</span> <span class="n">preprocessing</span> <span class="n">doesn</span><span class="s1">&#39;t extracts date and time</span>
                        <span class="n">features</span> <span class="k">for</span> <span class="n">it</span><span class="o">.</span> <span class="n">It</span> <span class="ow">is</span> <span class="n">just</span> <span class="n">tagged</span> <span class="k">as</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span>
                        <span class="n">the</span> <span class="n">schema</span> <span class="ow">and</span> <span class="n">used</span> <span class="k">for</span> <span class="n">splitting</span> <span class="n">train</span> <span class="o">/</span> <span class="nb">eval</span> <span class="n">data</span> <span class="k">if</span>
                        <span class="o">--</span><span class="n">dataset_split_strategy</span><span class="o">=</span><span class="n">temporal</span> <span class="ow">is</span> <span class="n">used</span><span class="o">.</span>
  <span class="o">--</span><span class="n">session_id_feature</span> <span class="n">SESSION_ID_FEATURE</span>
                        <span class="n">This</span> <span class="ow">is</span> <span class="n">just</span> <span class="k">for</span> <span class="n">tagging</span> <span class="n">this</span> <span class="n">feature</span><span class="o">.</span>
  <span class="o">--</span><span class="n">binary_classif_targets</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">tagged</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">schema</span> <span class="k">as</span> <span class="n">binary</span> <span class="n">target</span><span class="o">.</span> <span class="n">Merlin</span> <span class="n">Models</span> <span class="n">will</span> <span class="n">create</span> <span class="n">a</span>
                        <span class="n">binary</span> <span class="n">classification</span> <span class="n">head</span> <span class="k">for</span> <span class="n">each</span> <span class="n">of</span> <span class="n">these</span> <span class="n">targets</span><span class="o">.</span>
  <span class="o">--</span><span class="n">regression_targets</span> 
                        <span class="n">Columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">tagged</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">schema</span> <span class="k">as</span> <span class="n">binary</span> <span class="n">target</span><span class="o">.</span> <span class="n">Merlin</span> <span class="n">Models</span> <span class="n">will</span> <span class="n">create</span> <span class="n">a</span>
                        <span class="n">regression</span> <span class="n">head</span> <span class="k">for</span> <span class="n">each</span> <span class="n">of</span> <span class="n">these</span> <span class="n">targets</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="data-casting-and-filtering">
<h3>Data casting and filtering<a class="headerlink" href="#data-casting-and-filtering" title="Permalink to this headline"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">to_int32</span>            <span class="n">Cast</span> <span class="n">these</span> <span class="n">columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">to</span> <span class="n">int32</span><span class="o">.</span>
  <span class="o">--</span><span class="n">to_int16</span>            <span class="n">Cast</span> <span class="n">these</span> <span class="n">columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">to</span> <span class="n">int16</span><span class="p">,</span> <span class="n">to</span> <span class="n">save</span> <span class="n">some</span>
                        <span class="n">memory</span><span class="o">.</span>
  <span class="o">--</span><span class="n">to_int8</span>             <span class="n">Cast</span> <span class="n">these</span> <span class="n">columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">to</span> <span class="n">int32</span><span class="p">,</span> <span class="n">to</span> <span class="n">save</span> <span class="n">some</span>
                        <span class="n">memory</span><span class="o">.</span>
  <span class="o">--</span><span class="n">to_float32</span> 
                        <span class="n">Cast</span> <span class="n">these</span> <span class="n">columns</span> <span class="p">(</span><span class="n">comma</span><span class="o">-</span><span class="n">sep</span><span class="p">)</span> <span class="n">to</span> <span class="n">float32</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="filtering-and-frequency-capping">
<h1>Filtering and frequency capping<a class="headerlink" href="#filtering-and-frequency-capping" title="Permalink to this headline"></a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  --categ_min_freq_capping
                        Value used for min frequency capping. If greater than 0, all categorical values which are less frequent than this threshold will be mapped to the null value encoded id.
                        
  --min_user_freq 
                        Users with frequency lower than this value are removed
                        from the dataset (before data splitting).
  --max_user_freq 
                        Users with frequency higher than this value are
                        removed from the dataset (before data splitting).
  --min_item_freq 
                        Items with frequency lower than this value are removed
                        from the dataset (before data splitting).
  --max_item_freq 
                        Items with frequency higher than this value are
                        removed from the dataset (before data splitting).
  --num_max_rounds_filtering 
                        Max number of rounds interleaving users and items
                        frequency filtering. If a small number of rounds is
                        chosen, some low-frequent users or items might be kept
                        in the dataset. Default is 5
  --filter_query 
                        A filter query condition compatible with dask-cudf
                        `DataFrame.query()`
</pre></div>
</div>
<div class="section" id="dataset-splitting-train-and-eval-sets">
<h2>Dataset splitting (train and eval sets)<a class="headerlink" href="#dataset-splitting-train-and-eval-sets" title="Permalink to this headline"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">dataset_split_strategy</span> <span class="p">{</span><span class="n">random</span><span class="p">,</span><span class="n">random_by_user</span><span class="p">,</span><span class="n">temporal</span><span class="p">}</span>
                        <span class="n">If</span> <span class="kc">None</span><span class="p">,</span> <span class="n">no</span> <span class="n">data</span> <span class="n">split</span> <span class="ow">is</span> <span class="n">performed</span><span class="o">.</span> <span class="n">If</span> <span class="s1">&#39;random&#39;</span><span class="p">,</span>
                        <span class="n">samples</span> <span class="n">are</span> <span class="n">assigned</span> <span class="n">randomly</span> <span class="n">to</span> <span class="nb">eval</span> <span class="nb">set</span> <span class="n">according</span> <span class="n">to</span>
                        <span class="o">--</span><span class="n">random_split_eval_perc</span><span class="o">.</span> <span class="n">If</span> <span class="s1">&#39;random_by_user&#39;</span><span class="p">,</span> <span class="n">users</span>
                        <span class="n">will</span> <span class="n">have</span> <span class="n">examples</span> <span class="ow">in</span> <span class="n">both</span> <span class="n">train</span> <span class="ow">and</span> <span class="nb">eval</span> <span class="nb">set</span><span class="p">,</span>
                        <span class="n">according</span> <span class="n">to</span> <span class="n">the</span> <span class="n">proportion</span> <span class="n">specified</span> <span class="ow">in</span>
                        <span class="o">--</span><span class="n">random_split_eval_perc</span><span class="o">.</span> <span class="n">If</span> <span class="s1">&#39;temporal&#39;</span><span class="p">,</span> <span class="n">the</span>
                        <span class="o">--</span><span class="n">timestamp_feature</span> <span class="k">with</span>
                        <span class="o">--</span><span class="n">dataset_split_temporal_timestamp</span> <span class="n">to</span> <span class="n">split</span> <span class="nb">eval</span> <span class="nb">set</span>
                        <span class="n">based</span> <span class="n">on</span> <span class="n">time</span><span class="o">.</span>
  <span class="o">--</span><span class="n">random_split_eval_perc</span> 
                        <span class="n">Percentage</span> <span class="n">of</span> <span class="n">examples</span> <span class="n">to</span> <span class="n">be</span> <span class="n">assigned</span> <span class="n">to</span> <span class="nb">eval</span> <span class="nb">set</span><span class="o">.</span> <span class="n">It</span>
                        <span class="ow">is</span> <span class="n">used</span> <span class="k">with</span> <span class="o">--</span><span class="n">dataset_split_strategy</span> <span class="s1">&#39;random&#39;</span> <span class="ow">and</span>
                        <span class="s1">&#39;random_by_user&#39;</span>
  <span class="o">--</span><span class="n">dataset_split_temporal_timestamp</span> 
                        <span class="n">Used</span> <span class="n">when</span> <span class="o">--</span><span class="n">dataset_split_strategy</span> <span class="s1">&#39;temporal&#39;</span><span class="o">.</span> <span class="n">It</span>
                        <span class="n">assigns</span> <span class="k">for</span> <span class="nb">eval</span> <span class="nb">set</span> <span class="nb">all</span> <span class="n">examples</span> <span class="n">where</span> <span class="n">the</span>
                        <span class="o">--</span><span class="n">timestamp_feature</span> <span class="o">&gt;=</span> <span class="n">value</span>
</pre></div>
</div>
</div>
<div class="section" id="cuda-cluster-options">
<h2>CUDA cluster options<a class="headerlink" href="#cuda-cluster-options" title="Permalink to this headline"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">enable_dask_cuda_cluster</span>
                        <span class="n">Initializes</span> <span class="n">a</span> <span class="n">LocalCUDACluster</span> <span class="k">for</span> <span class="n">multi</span><span class="o">-</span><span class="n">GPU</span> <span class="n">preprocessing</span><span class="o">.</span>
                        <span class="n">This</span> <span class="ow">is</span> <span class="n">recommended</span> <span class="k">for</span> <span class="n">larger</span> <span class="n">dataset</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span>
                        <span class="n">errors</span><span class="p">,</span> <span class="n">when</span> <span class="n">multiple</span> <span class="n">GPUs</span> <span class="n">are</span> <span class="n">available</span><span class="o">.</span> <span class="n">By</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">False</span><span class="o">.</span>
  <span class="o">--</span><span class="n">dask_cuda_visible_gpu_devices</span> 
                        <span class="n">Ids</span> <span class="n">of</span> <span class="n">GPU</span> <span class="n">devices</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span>
                        <span class="n">preprocessing</span><span class="p">,</span> <span class="k">if</span> <span class="nb">any</span><span class="o">.</span> <span class="n">For</span> <span class="n">example</span><span class="p">:</span>
                        <span class="o">--</span><span class="n">visible_gpu_devices</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span> <span class="n">Default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="k">for</span> <span class="n">using</span> <span class="nb">all</span> <span class="n">GPUs</span>
  <span class="o">--</span><span class="n">dask_cuda_gpu_device_spill_frac</span> 
                        <span class="n">Percentage</span> <span class="n">of</span> <span class="n">GPU</span> <span class="n">memory</span> <span class="n">used</span> <span class="n">at</span> <span class="n">which</span>
                        <span class="n">LocalCUDACluster</span> <span class="n">should</span> <span class="n">spill</span> <span class="n">memory</span> <span class="n">to</span> <span class="n">CPU</span><span class="p">,</span> <span class="n">before</span>
                        <span class="n">raising</span> <span class="n">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span> <span class="n">errors</span><span class="o">.</span> <span class="n">Default</span> <span class="ow">is</span> <span class="mf">0.7</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, NVIDIA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v23.04.00
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../../../v22.10.00/index.html">v22.10.00</a></dd>
      <dd><a href="../../../../../v22.11.00/index.html">v22.11.00</a></dd>
      <dd><a href="../../../../../v22.12.00/index.html">v22.12.00</a></dd>
      <dd><a href="../../../../../v23.02.00/index.html">v23.02.00</a></dd>
      <dd><a href="index.html">v23.04.00</a></dd>
      <dd><a href="../../../../../v23.05.dev0/index.html">v23.05.dev0</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NVJ1Y1YJHK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-NVJ1Y1YJHK', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>