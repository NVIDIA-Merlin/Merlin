<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deploying a Multi-Stage Recommender System &mdash; Merlin  documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/mystnb.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="canonical" href="https://nvidia-merlin.github.io/Merlin/main/examples/Building-and-deploying-multi-stage-RecSys/index.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script >let toggleHintShow = 'Click to show';</script>
        <script >let toggleHintHide = 'Click to hide';</script>
        <script >let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Building Intelligent Recommender Systems with Merlin" href="01-Building-Recommender-Systems-with-Merlin.html" />
    <link rel="prev" title="Serve Recommendations from the TensorFlow Model" href="../getting-started-movielens/04-Triton-Inference-with-TF.html" /> 
</head>

<body class="wy-body-for-nav">
  <div class="banner">
    <p class="banner">
      Beginning in January 2023, versions for all NVIDIA Merlin projects
      will change from semantic versioning like <code>4.0</code>
      to calendar versioning like <code>23.01</code>.</p>
  </div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Merlin
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Example Notebooks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting-started-movielens/index.html">Getting Started using the MovieLens Dataset</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Deploying a Multi-Stage Recommender System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="01-Building-Recommender-Systems-with-Merlin.html">Building the Recommender System</a></li>
<li class="toctree-l3"><a class="reference internal" href="02-Deploying-multi-stage-RecSys-with-Merlin-Systems.html">Deploying the Recommender System with Triton</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sagemaker-tensorflow/index.html">Merlin and AWS SageMaker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scaling-criteo/index.html">Scaling Large Datasets with Criteo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../containers.html">Merlin Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support_matrix/index.html">Merlin Support Matrix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Merlin</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">NVIDIA Merlin Example Notebooks</a></li>
      <li class="breadcrumb-item active">Deploying a Multi-Stage Recommender System</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="deploying-a-multi-stage-recommender-system">
<h1>Deploying a Multi-Stage Recommender System<a class="headerlink" href="#deploying-a-multi-stage-recommender-system" title="Permalink to this headline"></a></h1>
<p>We created two Jupyter notebooks that demonstrate two different stages of recommender systems.
The notebooks show how to deploy a multi-stage recommender system and serve recommendations with Triton Inference Server.
The notebooks demonstrate how to use the NVTabular, Merlin Models, and Merlin Systems libraries for feature engineering, training, and then inference.</p>
<p>The two example notebooks are structured as follows:</p>
<ul class="simple">
<li><p><a class="reference internal" href="01-Building-Recommender-Systems-with-Merlin.html"><span class="doc std std-doc">Building the Recommender System</span></a>:</p>
<ul>
<li><p>Execute the preprocessing and feature engineering pipeline (ETL) with NVTabular on the GPU/CPU.</p></li>
<li><p>Train a ranking and retrieval model with TensorFlow based on the ETL output.</p></li>
<li><p>Export the saved models, user and item features, and item embeddings.</p></li>
</ul>
</li>
<li><p><a class="reference internal" href="02-Deploying-multi-stage-RecSys-with-Merlin-Systems.html"><span class="doc std std-doc">Deploying the Recommender System with Triton</span></a>:</p>
<ul>
<li><p>Set up a Feast feature store for feature storing and a Faiss index for similarity search.</p></li>
<li><p>Build a multi-stage recommender system ensemble pipeline with Merlin Systems operators.</p></li>
<li><p>Perform inference with the Triton Inference Server using the Merlin Systems library.</p></li>
</ul>
</li>
</ul>
<div class="section" id="running-the-example-notebooks">
<h2>Running the Example Notebooks<a class="headerlink" href="#running-the-example-notebooks" title="Permalink to this headline"></a></h2>
<p>Containers with the Merlin libraries are available from the NVIDIA NGC catalog.
To run the sample notebooks, use the <code class="docutils literal notranslate"><span class="pre">merlin-tensorflow</span></code> container.</p>
<p>You can pull and run the <code class="docutils literal notranslate"><span class="pre">nvcr.io/nvidia/merlin/merlin-tensorflow:nightly</span></code> container.</p>
<blockquote>
<div><p>In production, instead of using the <code class="docutils literal notranslate"><span class="pre">nightly</span></code> tag, specify a release tag.
You can find the release tags and more information on the <a class="reference external" href="https://catalog.ngc.nvidia.com/orgs/nvidia/teams/merlin/containers/merlin-tensorflow">Merlin TensorFlow</a> container page.</p>
</div></blockquote>
<p>To run the example notebooks using a container, do the following:</p>
<ol class="arabic">
<li><p>After you pull the container, launch it by running the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--gpus<span class="w"> </span>all<span class="w"> </span>-p<span class="w"> </span><span class="m">8000</span>:8000<span class="w"> </span>-p<span class="w"> </span><span class="m">8001</span>:8001<span class="w"> </span>-p<span class="w"> </span><span class="m">8002</span>:8002<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span>:8888<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span>&lt;path<span class="w"> </span>to<span class="w"> </span>your<span class="w"> </span>data&gt;:/workspace/data/<span class="w"> </span>--ipc<span class="o">=</span>host<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>nvcr.io/nvidia/merlin/merlin-tensorflow:nightly<span class="w"> </span>/bin/bash
</pre></div>
</div>
<p>You can remove the <code class="docutils literal notranslate"><span class="pre">--gpus</span> <span class="pre">all</span></code> flag to run the example on CPU.</p>
<p>The container opens a shell when the run command execution is complete.
Your shell prompt should look similar to the following example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>root@2efa5b50b909:
</pre></div>
</div>
</li>
<li><p>Start JupyterLab by running the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>jupyter-lab<span class="w"> </span>--allow-root<span class="w"> </span>--ip<span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="w"> </span>--NotebookApp.token<span class="o">=</span><span class="s1">&#39;&lt;password&gt;&#39;</span>
</pre></div>
</div>
<p>View the messages in your terminal to identify the URL for JupyterLab.
The messages in your terminal should show lines like the following example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Or copy and paste one of these URLs:
http://2efa5b50b909:8888/lab?token=9b537d1fda9e4e9cadc673ba2a472e247deee69a6229ff8d
or http://127.0.0.1:8888/lab?token=9b537d1fda9e4e9cadc673ba2a472e247deee69a6229ff8d
</pre></div>
</div>
</li>
<li><p>Open a browser and use the <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> URL provided in the messages from JupyterLab.</p></li>
<li><p>After you log in to JupyterLab, navigate to the <code class="docutils literal notranslate"><span class="pre">/Merlin/examples/Building-and-deploying-multi-stage-RecSys/</span></code> directory and execute the example notebooks.</p></li>
</ol>
</div>
<div class="toctree-wrapper compound">
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../getting-started-movielens/04-Triton-Inference-with-TF.html" class="btn btn-neutral float-left" title="Serve Recommendations from the TensorFlow Model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="01-Building-Recommender-Systems-with-Merlin.html" class="btn btn-neutral float-right" title="Building Intelligent Recommender Systems with Merlin" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, NVIDIA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v22.12.00
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../v22.10.00/index.html">v22.10.00</a></dd>
      <dd><a href="../../../v22.11.00/index.html">v22.11.00</a></dd>
      <dd><a href="index.html">v22.12.00</a></dd>
      <dd><a href="../../../v23.02.00/index.html">v23.02.00</a></dd>
      <dd><a href="../../../v23.04.00/index.html">v23.04.00</a></dd>
      <dd><a href="../../../v23.05.dev0/index.html">v23.05.dev0</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NVJ1Y1YJHK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-NVJ1Y1YJHK', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>