<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Benchmark of ranking models &mdash; Merlin  documentation</title><link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/mystnb.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/custom.css" type="text/css" />
    <link rel="canonical" href="https://nvidia-merlin.github.io/Merlin/main/examples/quick_start/scripts/ranking/hypertuning/index.html" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script >let toggleHintShow = 'Click to show';</script>
        <script >let toggleHintHide = 'Click to hide';</script>
        <script >let toggleOpenOnPrint = 'true';</script>
        <script src="../../../../../_static/togglebutton.js"></script>
        <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">
  <div class="banner">
    <p class="banner">
      Beginning in January 2023, versions for all NVIDIA Merlin projects
      will change from semantic versioning like <code>4.0</code>
      to calendar versioning like <code>23.01</code>.</p>
  </div>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Merlin
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../README.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Example Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../containers.html">Merlin Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../support_matrix/index.html">Merlin Support Matrix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Merlin</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Benchmark of ranking models</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="benchmark-of-ranking-models">
<h1>Benchmark of ranking models<a class="headerlink" href="#benchmark-of-ranking-models" title="Permalink to this headline"></a></h1>
<p>In this document, we describe a benchmark of ranking models available in Merlin <a class="reference external" href="https://github.com/NVIDIA-Merlin/models/">models</a> library for the TenRec dataset (described <span class="xref myst">here</span>), which you can use as a reference when deciding the models an hyperparameters you might want to try with your own dataset. We also share the search space used for hyperparameter optimization, that you reuse for your own hyperparameter tuning.
These results are reproduceable by using the TenRec and the quick-start scripts for preprocessing and training.</p>
<div class="section" id="neural-ranking-models">
<h2>Neural ranking models.<a class="headerlink" href="#neural-ranking-models" title="Permalink to this headline"></a></h2>
<p>This benchmark includes the following neural architectures for ranking, which are described in the <span class="xref myst">ranking script</span> and include links to the paper references and to models API docs.</p>
<ul class="simple">
<li><p><strong>Single-Task Learning (STL)</strong>: MLP, Wide&amp;Deep, DeepFM, DLRM, DCN-v2</p></li>
<li><p><strong>Multi-Task Learning (MTL)</strong>: MLP, MMOE, PLE</p></li>
</ul>
</div>
<div class="section" id="hyperparameter-tuning-setup">
<h2>Hyperparameter tuning setup<a class="headerlink" href="#hyperparameter-tuning-setup" title="Permalink to this headline"></a></h2>
<p>For a fair comparison of the models, we ran a separate hyperparameter tuning process for each model architecture using TenRec dataset, which we call experiment group. We use the <a class="reference external" href="https://docs.wandb.ai/guides/sweeps">Weights&amp;Biases Sweeps</a> feature for managing the hypertuning process for each experiment group. The hypertuning uses bayesian optimization (<code class="docutils literal notranslate"><span class="pre">method=bayes</span></code>) to improve the <code class="docutils literal notranslate"><span class="pre">AUC</span></code> metric, which is different for STL and MTL, as explained below.</p>
<p>You can find the <span class="xref myst">hyperparameter space configurations</span> and a <a class="reference internal" href="tutorial_with_wb_sweeps.html"><span class="doc std std-doc">tutorial</span></a> on how to use <a class="reference external" href="https://docs.wandb.ai/guides/sweeps">Weights&amp;Biases Sweeps</a> to run the hyperparameter tuning.</p>
<div class="section" id="single-task-learning">
<h3>Single-task learning<a class="headerlink" href="#single-task-learning" title="Permalink to this headline"></a></h3>
<p>For benchmarking the ranking models with single-task learning we used the <code class="docutils literal notranslate"><span class="pre">click</span></code> binary target, as it is the most frequent event in the dataset. 200 trials were performed for each experiment group.</p>
<div class="section" id="benchmark-results">
<h4>Benchmark results<a class="headerlink" href="#benchmark-results" title="Permalink to this headline"></a></h4>
<p>In the following table, you can see the models with the best accuracy (AUC) for predicting the <code class="docutils literal notranslate"><span class="pre">click</span></code> target. You can see the models have a similar level of accuracy, maybe because the dataset contains only 5 basic features (which are presented <span class="xref myst">here</span>). But you can notice that models more advanced than MLP can provide better accuracy.</p>
<center>
<img src="../../../images/stl_benchmark.png" alt="Multi-task learning architectures" >
</center>
</div>
<div class="section" id="most-important-hyperparameters">
<h4>Most important hyperparameters<a class="headerlink" href="#most-important-hyperparameters" title="Permalink to this headline"></a></h4>
<p><strong>MLP</strong></p>
<center>
<img src="../../../images/most_important_hparams/stl_mlp_click.png">
</center>
<p><strong>Wide&amp;Deep</strong></p>
<center>
<img src="../../../images/most_important_hparams/stl_wideanddeep_click.png">
</center>
<p><strong>DeepFM</strong></p>
<center>
<img src="../../../images/most_important_hparams/stl_deepfm_click.png">
</center>
<p><strong>DLRM</strong></p>
<center>
<img src="../../../images/most_important_hparams/stl_dlrm_click.png">
</center>
<p><strong>DCN-v2</strong></p>
<center>
<img src="../../../images/most_important_hparams/stl_dcn_click.png">
</center>
</div>
<div class="section" id="best-runs-hyperparameters">
<h4>Best runs hyperparameters<a class="headerlink" href="#best-runs-hyperparameters" title="Permalink to this headline"></a></h4>
<p>TO INCLUDE</p>
</div>
</div>
<div class="section" id="multi-task-learning">
<h3>Multi-task learning<a class="headerlink" href="#multi-task-learning" title="Permalink to this headline"></a></h3>
<p>For multi-task learning models we use as hypertuning maximization objective the average AUC of the binary targets: <code class="docutils literal notranslate"><span class="pre">click</span></code>,<code class="docutils literal notranslate"><span class="pre">like</span></code>,<code class="docutils literal notranslate"><span class="pre">share</span></code> and <code class="docutils literal notranslate"><span class="pre">follow</span></code>.</p>
<p>We use the following strategy for hypertuning the models:</p>
<ol class="arabic simple">
<li><p>200 trials optimizing all hyperparameters except the ones that deal with positive class weight and losses weight, to reduce the search space</p></li>
<li><p>Take the best model hyperparameters from (1) and optimize only positive class weight and losses weight, for 200 trials.</p></li>
</ol>
<p>TODO: Describe results</p>
<center>
<img src="../../../images/stl_mtl_benchmark.png" alt="Multi-task learning architectures" >
</center>
<div class="section" id="id1">
<h4>Most important hyperparameters<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h4>
<p><strong>MLP</strong></p>
<center>
<img src="../../../images/most_important_hparams/mtl_mlp.png">
</center>
<p><strong>MMOE</strong></p>
<center>
<img src="../../../images/most_important_hparams/mtl_mmoe.png">
</center>
<p><strong>PLE</strong></p>
<center>
<img src="../../../images/most_important_hparams/mtl_ple.png">
</center>
</div>
<div class="section" id="id2">
<h4>Best runs hyperparameters<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h4>
<p>TODO</p>
</div>
</div>
<div class="section" id="improvements-with-hyperparameter-tuning">
<h3>Improvements with hyperparameter tuning<a class="headerlink" href="#improvements-with-hyperparameter-tuning" title="Permalink to this headline"></a></h3>
<p>Analysis on the number of experiments necessary to achieve best accuracy</p>
<ul class="simple">
<li><p>Plot the boxplot per model of the accuracy, to showcase how much it might vary</p></li>
<li><p>Plot the HPO avg curves over 200 trials for the different models (maybe also keep the dots), to showcase for how many trials HPO should be run</p></li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, NVIDIA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NVJ1Y1YJHK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-NVJ1Y1YJHK', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>